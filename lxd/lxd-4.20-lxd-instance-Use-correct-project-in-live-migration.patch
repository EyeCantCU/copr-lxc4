From 4b5a3ac89ab48f09ee1c053dec35ea6f94b06f9d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Mon, 8 Nov 2021 15:16:36 -0500
Subject: [PATCH] lxd/instances: Use correct project in live migration
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxd/instance_post.go | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/lxd/instance_post.go b/lxd/instance_post.go
index 3809a40fbfa..df41ebdf15a 100644
--- a/lxd/instance_post.go
+++ b/lxd/instance_post.go
@@ -735,6 +735,9 @@ func instancePostClusteringMigrateWithCeph(d *Daemon, r *http.Request, inst inst
 				}
 			}
 		} else {
+			// Use the correct project.
+			target = target.UseProject(inst.Project())
+
 			// Create the instance mount point.
 			url := api.NewURL().Project(inst.Project()).Path("internal", "cluster", "instance-moved", newName)
 			resp, _, err := target.RawQuery("POST", url.String(), nil, "")
