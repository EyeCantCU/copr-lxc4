From 4bb04da567c8794a1ad77b346eb824662aa4a451 Mon Sep 17 00:00:00 2001
From: Gabriel Mougard <gabriel.mougard@canonical.com>
Date: Wed, 19 Apr 2023 19:01:23 +0200
Subject: [PATCH] instance: no timeout on the operationlock for creating an
 instance

Signed-off-by: Gabriel Mougard <gabriel.mougard@canonical.com>
---
 lxd/instance/operationlock/operationlock.go | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lxd/instance/operationlock/operationlock.go b/lxd/instance/operationlock/operationlock.go
index e002893d80ba..dc81de0fefe0 100644
--- a/lxd/instance/operationlock/operationlock.go
+++ b/lxd/instance/operationlock/operationlock.go
@@ -98,6 +98,10 @@ func Create(projectName string, instanceName string, action Action, createReusua
 
 	go func(op *InstanceOperation) {
 		timeout := TimeoutDefault
+		if action == ActionCreate {
+			timeout = -1
+		}
+
 		timer := time.NewTimer(timeout)
 		defer timer.Stop()
 
