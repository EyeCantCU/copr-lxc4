From 7de0d438dc5039f7a6036c19e0899a9a6ece35f6 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Julian=20Peliz=C3=A4us?= <julian.pelizaeus@canonical.com>
Date: Wed, 5 Jul 2023 16:57:58 +0200
Subject: [PATCH] lxd/api/cluster: Remove obsolete group delete/create for post
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The `nodes_cluster_groups` table doesn't have a row with the
given group_id if the group itself doesn't have any members.

Since the members get compared and created/removed already by
another loop, this deletion/creation is not required.

Signed-off-by: Julian Peliz√§us <julian.pelizaeus@canonical.com>
---
 lxd/api_cluster.go | 17 -----------------
 1 file changed, 17 deletions(-)

diff --git a/lxd/api_cluster.go b/lxd/api_cluster.go
index 39d0def4c893..c86d2200f909 100644
--- a/lxd/api_cluster.go
+++ b/lxd/api_cluster.go
@@ -4005,23 +4005,6 @@ func clusterGroupPut(d *Daemon, r *http.Request) response.Response {
 			return err
 		}
 
-		groupID, err := dbCluster.GetClusterGroupID(ctx, tx.Tx(), obj.Name)
-		if err != nil {
-			return err
-		}
-
-		err = dbCluster.DeleteNodeClusterGroup(ctx, tx.Tx(), int(groupID))
-		if err != nil {
-			return err
-		}
-
-		for _, node := range obj.Nodes {
-			_, err = dbCluster.CreateNodeClusterGroup(ctx, tx.Tx(), dbCluster.NodeClusterGroup{GroupID: int(groupID), Node: node})
-			if err != nil {
-				return err
-			}
-		}
-
 		members, err := tx.GetClusterGroupNodes(ctx, name)
 		if err != nil {
 			return err
