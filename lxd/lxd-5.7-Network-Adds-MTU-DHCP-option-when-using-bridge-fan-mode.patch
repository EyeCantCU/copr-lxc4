From 35d92be45094128b13ae463301894f86ac3dcf79 Mon Sep 17 00:00:00 2001
From: Thomas Parrott <thomas.parrott@canonical.com>
Date: Fri, 4 Nov 2022 11:03:58 +0000
Subject: [PATCH] lxd/network/driver/bridge: Adds MTU DHCP option when using
 fan mode

Needed when using fan mode with VMs.

Fixes #11072

Signed-off-by: Thomas Parrott <thomas.parrott@canonical.com>
---
 lxd/network/driver_bridge.go | 1 +
 1 file changed, 1 insertion(+)

diff --git a/lxd/network/driver_bridge.go b/lxd/network/driver_bridge.go
index fcdf42882378..c96c35ce7314 100644
--- a/lxd/network/driver_bridge.go
+++ b/lxd/network/driver_bridge.go
@@ -1286,6 +1286,7 @@ func (n *bridge) setup(oldConfig map[string]string) error {
 		dnsmasqCmd = append(dnsmasqCmd, []string{
 			fmt.Sprintf("--listen-address=%s", addr[0]),
 			"--dhcp-no-override", "--dhcp-authoritative",
+			fmt.Sprintf("--dhcp-option-force=26,%d", fanMtuInt),
 			fmt.Sprintf("--dhcp-leasefile=%s", shared.VarPath("networks", n.name, "dnsmasq.leases")),
 			fmt.Sprintf("--dhcp-hostsfile=%s", shared.VarPath("networks", n.name, "dnsmasq.hosts")),
 			"--dhcp-range", fmt.Sprintf("%s,%s,%s", dhcpalloc.GetIP(hostSubnet, 2).String(), dhcpalloc.GetIP(hostSubnet, -2).String(), expiry)}...)
